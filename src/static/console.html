<!DOCTYPE html>
<html lang="es" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DirIA Console</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        diria: {
                            green: '#2D5016',
                            neonGreen: '#00ff9d',
                            blue: '#0077BE',
                            dark: '#0a0a0a',
                            card: '#111111',
                            border: '#333333'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0a0a0a;
            color: #e5e5e5;
        }

        .chat-bubble-user {
            background-color: #0077BE;
            color: white;
            border-radius: 18px 18px 0 18px;
        }

        .chat-bubble-bot {
            background-color: #1a1a1a;
            color: #e5e5e5;
            border: 1px solid #333;
            border-radius: 18px 18px 18px 0;
        }

        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden font-sans">

    <!-- Header -->
    <header class="h-16 border-b border-diria-border flex items-center justify-between px-6 bg-diria-card">
        <div class="flex items-center gap-3">
            <a href="/" class="text-diria-muted hover:text-white mr-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
            </a>
            <img src="static/img/guana_logo_dark.png" alt="Logo" class="h-8 w-auto">
            <span class="font-bold text-lg text-white">DirIA Console</span>
        </div>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-green-900/30 border border-green-500/30">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-xs font-medium text-green-400">System Online</span>
            </div>
            <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold text-white">
                JS</div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">
        <!-- Sidebar (Tools) -->
        <aside class="w-64 border-r border-diria-border bg-diria-card hidden md:flex flex-col">
            <div class="p-4">
                <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">Herramientas</h3>
                <nav class="space-y-1">
                    <a href="#" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-white/5 text-white">
                        <span class="text-lg">üí¨</span> Chat
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white transition">
                        <span class="text-lg">üöó</span> Claims
                    </a>
                    <a href="#"
                        class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white transition">
                        <span class="text-lg">üìä</span> Analytics
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Chat Area -->
        <section class="flex-1 flex flex-col bg-black relative">
            <!-- Messages -->
            <div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- Welcome Message -->
                <div class="flex items-start gap-4">
                    <div
                        class="w-10 h-10 rounded-full bg-diria-card border border-diria-border flex items-center justify-center text-xl">
                        üèîÔ∏è</div>
                    <div class="chat-bubble-bot p-4 max-w-2xl shadow-sm">
                        <p class="font-medium mb-1 text-diria-neonGreen">DirIA</p>
                        <p class="text-sm leading-relaxed">Hola, soy DirIA. Estoy conectado a todas las cimas de Guana
                            Cloud. ¬øEn qu√© puedo ayudarte hoy?</p>
                        <div class="mt-3 flex gap-2">
                            <button
                                class="text-xs bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-1.5 rounded-full transition">Crear
                                Tiquete</button>
                            <button
                                class="text-xs bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-1.5 rounded-full transition">Consultar
                                Datos</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t border-diria-border bg-diria-card">
                <div class="max-w-4xl mx-auto relative">
                    <input type="text" id="user-input" placeholder="Escribe tu consulta aqu√≠..."
                        class="w-full bg-black border border-diria-border rounded-xl pl-4 pr-12 py-4 text-white placeholder-gray-500 focus:outline-none focus:border-diria-neonGreen focus:ring-1 focus:ring-diria-neonGreen transition shadow-lg">
                    <button id="send-btn"
                        class="absolute right-2 top-2 p-2 bg-diria-neonGreen text-black rounded-lg hover:bg-white transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
                <p class="text-center text-xs text-gray-600 mt-2">DirIA puede cometer errores. Verifica la informaci√≥n
                    importante.</p>
            </div>
        </section>
    </main>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        function addMessage(text, isUser) {
            const div = document.createElement('div');
            div.className = `flex items-start gap-4 ${isUser ? 'flex-row-reverse' : ''}`;

            const avatar = isUser ?
                `<div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold text-white">JS</div>` :
                `<div class="w-10 h-10 rounded-full bg-diria-card border border-diria-border flex items-center justify-center text-xl">üèîÔ∏è</div>`;

            const bubbleClass = isUser ? 'chat-bubble-user' : 'chat-bubble-bot';
            const nameColor = isUser ? 'text-white' : 'text-diria-neonGreen';
            const name = isUser ? 'T√∫' : 'DirIA';

            div.innerHTML = `
                ${avatar}
                <div class="${bubbleClass} p-4 max-w-2xl shadow-sm">
                    <p class="font-medium mb-1 ${nameColor} text-xs uppercase tracking-wide">${name}</p>
                    <p class="text-sm leading-relaxed whitespace-pre-wrap">${text}</p>
                </div>
            `;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            addMessage(text, true);
            userInput.value = '';

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'flex items-start gap-4';
            typingDiv.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-diria-card border border-diria-border flex items-center justify-center text-xl">üèîÔ∏è</div>
                <div class="chat-bubble-bot p-4 shadow-sm">
                    <div class="flex gap-1">
                        <div class="w-2 h-2 bg-gray-500 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full typing-dot"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            try {
                const response = await fetch('/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'MESSAGE',
                        source: 'web_console',
                        user: { email: 'web_guest@diria.io' },
                        message: { text: text }
                    })
                });

                const data = await response.json();
                document.getElementById('typing-indicator').remove();

                if (data.text) {
                    addMessage(data.text, false);
                } else {
                    addMessage("Error: No se recibi√≥ respuesta.", false);
                }
            } catch (error) {
                document.getElementById('typing-indicator').remove();
                addMessage("Error de conexi√≥n.", false);
                console.error(error);
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>

</html>